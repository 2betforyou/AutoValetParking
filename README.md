# 🚗 Autonomous Valet Parking System
> 중앙 제어형 자율 발렛 주차 시스템 (CAU 2025 AI·SW 융합 우수성과 발표대회 출품작)

---

## 📖 프로젝트 개요
**Autonomous Valet Parking System**은 실내 주차장 환경에서도 차량이 스스로 경로를 탐색하고,  
중앙 제어 서버가 모든 차량의 위치와 이동을 실시간으로 관리하여 **충돌 없는 입출차와 공간 효율성 극대화**를 실현하는 시스템입니다.

- **문제 인식**  
  - 출구 근처만 이용하려는 운전자 패턴으로 인한 병목 및 공간 낭비  
  - 차량 간 충돌 위험 및 불필요한 대기시간 발생  
  - 실내 주차장에서 GPS가 작동하지 않아 위치 인식 불가  

- **해결 접근**  
  - 중앙 제어 서버 기반의 **ReservationTable + Network Graph(A\*) 경로 제어**  
  - **SimPy 이벤트 시뮬레이션 엔진**을 이용한 시간·공간 기반 최적화  
  - SLAM / GCSLAM 기반 차량 위치 추정 및 자율 주행  

---

## 🧠 주요 기능
| 구분 | 기능 설명 |
|------|------------|
| 🕹️ 중앙 제어 서버 | 모든 차량의 위치·경로·층간 이동을 실시간 관리하며, 동일 도로 구간의 중복 예약을 방지 |
| 🚘 차량 에이전트 | GCSLAM 기반 센서 융합을 통해 실내 환경에서도 자율 위치 추정 및 이동 수행 |
| ⏱️ ReservationTable | 시간 단위로 각 노드·엣지를 예약하여 교차 충돌 방지 및 교통 흐름 동기화 |
| 🅿️ 스팟 보호 시스템 | SimPy `Resource` 객체를 이용해 주차 스팟 점유/선점 상태를 동시 제어 |
| 🧭 지능형 경로 탐색 | A\* 알고리즘 기반 최단·최적 경로 탐색 (교착 구간 자동 회피) |

---

## 🖼️ 시뮬레이션 결과 (Two-Floor, Reservation-Based)
아래 GIF는 **복층 주차장(B1/B2)**에서 중앙 관제 서버가 시간 기반 예약(ReservationTable)으로 **교차점·엣지 충돌을 사전에 차단**하며,  
차량의 입차/주차/출차를 제어하는 과정을 시각화한 결과입니다.

![Combined Two-Floor Simulation](output/combined_twofloors_20251111_171200.gif)

### 🗺️ 표기·색상 규칙
- **바닥 타일 문자**
  - `0` : 진입/출구(게이트 포함) · 옅은 파란색
  - `-` / `|` : 수평/수직 차로
  - `G` : 빈 주차 스팟(초록 배경)
  - `R` : 점유된 주차 스팟(빨간 배경)
- **차량 표시**
  - 파란 원: **입차/이동 중** 차량
  - 빨간 원: **출차 경로 예약 후** 이동 중 차량 (`exiting=True`)
  - 원 안 숫자: 차량 ID
- **레이어**
  - 상단: **Floor B1**
  - 하단: **Floor B2** (렌더링 시 B1 아래로 오프셋)

### 🧠 핵심 제어 로직 (요약)
- **중앙 관제(ControlTower)**
  - `ReservationTable`을 통해 시간창 단위로 **엣지/노드/커넥터 예약**을 관리합니다.
    - `book_edge[(fid, ek)]`, `book_node[(fid, node)]`, `book_conn`에 `(t0, t1, vid)`로 기록
  - 주차 스팟은 **SimPy Resource(capacity=1)**로 **물리적 락**을 겁니다.  
    같은 스팟에 동시 진입 불가 (`get_spot_lock(fid, spot)`).
  - 스팟 선점 집합(`claimed`)과 **점유 시간대 리스트(`occ`)**로 **논리적 중복**도 방지합니다.
- **경로 계획 (A*)**
  - 진입: `build_composite_path_to_spot(fid_dest, spot)`
    - B1이면 바로 B1 경로, B2면 **B1→커넥터(XFER)→B2**로 세그먼트 합성
  - 출차: `build_composite_path_to_exit(fid_src, spot)`
    - B2 출차 시 **B2 출구→커넥터→B1 출구**로 합성
  - 실제 A* 탐색은 `build_route_subgraph`로 차선(`-`,`|`)·출입구(`0`)만 허용한 **서브그래프**에서 수행
- **예약·커밋**
  - 각 세그먼트(노드 u→v, `dur`)에 대해 `(t0,t1)` 창을 먼저 **컨플릭트 체크**한 뒤,
  - 통과 시 `commit_edge/commit_node/commit_connector`로 **원자적 커밋**하고,
  - 시각화용 궤적(`traj[fid]`)에 `(ui,uj)→(vi,vj), t0,t1, exiting`을 기록합니다.

### 🔁 재탐색·대기 전략
- 경로가 없거나 예약 충돌이면 **REPLAN_DELAY** 동안 **주차칸 정지 세그먼트**를 추가로 기록하여  
  화면에서 차량이 “기다리는” 상태가 자연스럽게 보이도록 합니다.
- 스팟이 이미 선점되었거나 예약이 막힐 경우, **선점 해제 → 재검색** 루프를 수행합니다.

### ⚠️ 주의 사항
- 경로 허용 규칙은 **기호와 방향성**에 따라 제한됩니다.  
  예를 들어, `G/R`는 **수평('-') 간선과만 연결**되고, `|`는 **수직 통과만 허용**합니다.  
  (코드: `build_grid_graph().can_connect(...)`)
- `ReservationTable`의 시간창은 **엣지·노드·커넥터** 모두에 대해 겹치면 예약 실패입니다.  
  같은 교차점/차로를 같은 시간에 두 차량이 통과하지 못하도록 설계했습니다.

---

## ⚙️ 시스템 구성
- **Simulation Core** : `SimPy` 기반의 이벤트 시뮬레이션
- **Control Server** : Python 모듈 기반 중앙 통제 로직
- **Vehicle Agent** : SLAM 모듈 시뮬레이션
- **Graph Planner** : A\* + ReservationTable 조합의 시간 기반 경로 탐색기
- **Output Visualization** : Matplotlib / ASCII 맵 기반 주차장 시각화

---

## 💻 실행 방법
### 1️⃣ 환경 세팅
```bash
git clone https://github.com/<username>/<repo_name>.git
cd <repo_name>
pip install -r requirements.txt
```

### 2️⃣ 코드 실행
```bash
python run.py
```
실행 시 중앙 제어 서버가 초기화되고, 각 차량의 이동 시뮬레이션이 자동으로 시작됩니다.

## 🌍 기대효과
- **운영 효율성**: 동일 면적 내 주차 대수 증가 → 부동산 가치 상승 및 수익 증대  
- **경제성**: 조명·환기 등 에너지 절감 + 인력 운영 비용 절감  
- **안전성**: 인적 오류 제거로 후방 추돌 및 긁힘 사고 감소  
- **환경성**: 주차 탐색시간 단축으로 연료 소비 및 온실가스 배출 감소  

> 스마트 주차 시스템 도입 시 교통 혼잡이 **최대 30% 감소** (사례 참조)

---

## ⚠️ 한계 및 향후 개선점
| 항목 | 내용 |
|------|------|
| 초기 투자비 | 센서, 라이다, 통신 인프라 등 설치비용이 높음 |
| 유지보수 | 지속적인 하드웨어 교체 및 소프트웨어 업데이트 필요 |
| 사용자 적응 | 기술 미숙지로 인한 초기 사용 불편 |
| 보안 문제 | 네트워크 연결 기반 시스템 특성상 해킹·데이터 유출 위험 존재 |

---
<!-- 
## 🧩 팀 정보
| 이름 | 학과 | 학번 | 이메일 |
|------|------|------|--------|
| 박준영 | 예술공학부 | 20226669 | june295921@cau.ac.kr |
| 주성용 | 산업보안학과 | 20212658 | jusy4901@cau.ac.kr |

--- -->

## 🏫 제출 정보
- **대회명:** 2025 중앙대학교 AI·SW 융합 우수성과 발표대회  
- **작품명:** Autonomous Valet Parking System  
- **팀명:** 내일은 주차왕  
- **실행 파일:** `run.py`

---

## 📄 라이선스
본 프로젝트는 교육 및 연구 목적의 비상업적 사용에 한합니다.  
상업적 사용 또는 2차 배포 시 반드시 팀의 허가가 필요합니다.

---

> 상상을 현실로, 미래를 코드로.  
> Autonomous Valet Parking System 🚙💡

